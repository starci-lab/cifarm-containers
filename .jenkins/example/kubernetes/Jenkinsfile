pipeline {
  agent {
    kubernetes {
      yamlFile 'agent.yaml'
      }
    }

  stages {
    stage('Test Kubernetes') {
      steps {
      container(name: 'kubectl', shell: '/bin/sh') {
        withCredentials(file(credentialsId: 'kubeconfig', variable: 'KUBECONFIG')) {
            sh "echo $KUBECONFIG > /.kube/config"
            sh "kubectl get pods -n"
          }
        }
      }
    }
  }
}