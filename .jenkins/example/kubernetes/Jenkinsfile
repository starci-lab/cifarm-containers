pipeline {
  agent {
    kubernetes {
      yamlFile 'agent.yaml'
      }
    }

  stages {
    stage('Test Kubernetes') {
      steps {
      container(name: 'kubectl', shell: '/bin/sh') {
        withCredentials(credentialsId: 'jenkins-token') {
            sh "kubectl get pods -n cicd"
          }
        }
      }
    }
  }
}