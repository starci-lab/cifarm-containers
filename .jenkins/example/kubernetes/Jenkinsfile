podTemplate(

    containers: [
        // Use the Bitnami kubectl container to avoid downloading kubectl manually
        containerTemplate(
            name: 'kubectl',
            image: 'bitnami/kubectl:1.20.5',
            command: 'cat', // This is a no-op, we just need the container to run
            ttyEnabled: true
        )
    ]
) {
    node(POD_LABEL) {
        stage('Run kubectl commands') {
            container('kubectl') {
                // Use kubectl directly from the Bitnami container
                sh 'kubectl get pods -n cicd' // List pods in the cicd namespace
            }
        }
    }
}